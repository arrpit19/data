group_by(qc) %>%
count(value)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
mutate(qc4_temp_1=sicc=="sunshine",
qc4_temp_2=sicc=="sunshine (bright)")
qc4_hobo %>%
filter(qc4_1)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
mutate(qc4_temp_1=sicc=="sunshine",
qc4_temp_2=sicc=="sunshine (bright)") %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
mutate(qc4_temp_flag_1=ifelse(is.na(qc4_temp_flag_1),TRUE,qc4_temp_flag_1),
qc4_temp_flag_2=ifelse(is.na(qc4_temp_flag_2),TRUE,qc4_temp_flag_2)) %>%
filter(time=="day")
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
mutate(qc4_temp_1=sicc=="sunshine",
qc4_temp_2=sicc=="sunshine (bright)") %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
mutate(qc4_temp_flag_1=ifelse(is.na(qc4_temp_flag_1),TRUE,qc4_temp_flag_1),
qc4_temp_flag_2=ifelse(is.na(qc4_temp_flag_2),TRUE,qc4_temp_flag_2)) %>%
filter(time=="day") %>%
filter(qc4_1 | qc4_2)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
mutate(qc4_temp_1=sicc=="sunshine",
qc4_temp_2=sicc=="sunshine (bright)") %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
mutate(qc4_temp_flag_1=ifelse(is.na(qc4_temp_flag_1),TRUE,qc4_temp_flag_1),
qc4_temp_flag_2=ifelse(is.na(qc4_temp_flag_2),TRUE,qc4_temp_flag_2)) %>%
filter(time=="day") %>%
filter(qc4_temp_flag_1 | qc4_temp_flag_2)
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
group_by(time) %>%
summarize(n=n())
qc4_failed <- qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
group_by(time) %>%
summarize(n=n())
qc4_failed %>%
ggplot(aes(time,n))+
geom_line(col=graph_color)+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_hobo
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm))
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm))
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time) %>%
group_by(time,qc) %>%
summarize(n=n())
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=n())
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=n()) %>%
summarize(sum=sum(n))
qc4_failed %>%
ggplot(aes(time,sum))+
geom_line(col=graph_color)+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed
qc4_failed <- qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=n()) %>%
summarize(sum=sum(n))
qc4_failed %>%
ggplot(aes(time,sum))+
geom_line(col=graph_color)+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed %>%
ggplot(aes(time,sum))+
geom_line(col=graph_color)+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$sum),max(qc4_failed$sum),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed <- qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=n())
qc4_failed
qc4_failed %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed <- qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=n())
qc4_failed %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed
qc4_failed %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()
qc4_failed
qc4_hobo %>%
filter(qc4_1|qc4_2)
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm))
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=n())
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc)
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc)
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=sum())
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id)
qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=sum(value))
qc4_failed %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed <- qc4_hobo %>%
filter(qc4_1|qc4_2) %>%
mutate(time=as_hms(dttm)) %>%
gather(qc,value,-dttm,-temp,-lux,-time,-id) %>%
group_by(time,qc) %>%
summarize(n=sum(value))
qc4_failed %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
labs(x="Time of the Day",y="Number of Flagged Points")
qc4_failed %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
scale_color_viridis_d("QC4")+
labs(x="Time of the Day",y="Number of Flagged Points")
flagged_data
flagged_data
flagged_data %>%
select(contains("qc"))
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot)
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(all_vars(),sum)
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(all_vars(),function(x) sum(x))
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(sum)
qc4_failed %>%
filter(n>0) %>%
ggplot(aes(time,n,col=qc))+
geom_line()+
geom_point()+
scale_y_continuous(breaks = seq(min(qc4_failed$n),max(qc4_failed$n),2))+
scale_color_viridis_d("QC4")+
labs(x="Time of the Day",y="Number of Flagged Points")
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(sum)
library(tidyverse)
library(lubridate)
library(zoo)
library(hms)
library(glue)
library(knitr)
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(sum) %>%
kable()
flagged_data
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(sum)
flagged_data %>%
select(contains("qc")) %>%
select(-qc_tot) %>%
summarize_all(sum) %>%
gather(QC,N) %>%
kable()
flagged_data %>%
select(contains("qc"))
flagged_data %>%
mutate(time=as_hms(dttm)) %>%
mutate(daytime=case_when(
time>=morning_start & time<=morning_end ~ "morning",
time>=afternoon_start & time<=afternoon_end ~ "afternoon",
time>=evening_start & time<=evening_end ~ "evening",
TRUE~"night"
)) %>%
mutate(daytime=factor(daytime,levels = c("morning","afternoon",
"evening",
"night"))) %>%
select(-time) %>%
gather(qc,check,-id,-dttm,-temp,-lux,-daytime) %>%
group_by(qc,daytime) %>%
summarize(no_checks=sum(check,na.rm=T)) %>%
ggplot(aes(qc,no_checks,fill=daytime))+
geom_col()+
labs(x="Qualitc Control Check",y="Number of Failed Checks")+
scale_fill_viridis_d("Time",direction=-1)
flagged_data <- data %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate(qc4_1=ifelse(is.na(qc4_1),FALSE,qc4_1),
qc4_2=ifelse(is.na(qc4_2),FALSE,qc4_2))
flagged_data
flagged_data %>%
select(contains("qc")) %>%
summarize_all(sum) %>%
gather(QC,N) %>%
kable()
flagged_data %>%
select(contains("qc")) %>%
summarize_all(sum) %>%
gather(QC,N) %>%
kable(align = "cc")
install.packages("kableExtra")
library(tidyverse)
library(lubridate)
library(zoo)
library(hms)
library(glue)
library(knitr)
library(kableExtra)
?kable_styling
data_finished
hourly_data
data_finished
data_finished
write_csv(select(data_finished,dttm,temp=filled_hobo,origin),
"D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\10760709_th.csv")
write_csv(select(data_finished,dttm=format(dttm,format="%Y-m-%d %H:%M:%S"),temp=filled_hobo,origin),
"D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\10760709_th.csv")
data_finished %>%
mutate(dttm=format(dttm,format="%Y-m-%d %H:%M:%S"))
data_finished %>%
mutate(dttm=format(dttm,format="%Y-%m-%d %H:%M:%S"))
data_finished %>%
mutate(dttm=format(dttm,format="%Y-%m-%d %H:%M:%S")) %>%
select(dttm,th=filled_hobo,origin)
data_finished %>%
mutate(dttm=format(dttm,format="%Y-%m-%d %H:%M:%S")) %>%
select(dttm,th=filled_hobo,origin) %>%
write_csv("D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\10760709_th.csv")
data_export <- data_finished %>%
mutate(dttm=format(dttm,format="%Y-%m-%d %H:%M:%S")) %>%
select(dttm,th=filled_hobo,origin)
write_csv(data_export,"D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\10760709_th.csv")
write_csv(data_export,"D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\10760709_th.csv")
data_export <- data_finished %>%
mutate(dttm=format(dttm,format="%Y-%m-%d %H:%M:%S"),
filled_hobo=round(filled_hobo,3)) %>%
select(dttm,th=filled_hobo,origin)
data_export
write_csv(data_export,"D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\10760709_th.csv")
library(tidyverse)
install.packages("RPostgreSQL")
library(RPostgreSQL)
driver <- dbDriver("PostgreSQL")
library(askpass)
con <- dbConnect(drv,
dbname="hydenv",
host="localhost",
port=5432,
user="hydenv",
password=askpass())
con <- dbConnect(driver,
dbname="hydenv",
host="localhost",
port=5432,
user="hydenv",
password=askpass())
data <- dbGetQuery(con,
"SELECT *
FROM raw_data")
con
con <- dbConnect(driver,
dbname="hydenv",
host="localhost",
port=5432,
user="hydenv",
password=askpass())
con
pw <- askpass()
pw
con <- dbConnect(driver,
dbname="hydenv",
host="localhost",
port=5432,
user="hydenv",
password=pw)
con <- dbConnect(driver,
dbname="hydenv",
host="localhost",
port=5432,
user="postgres",
password=pw)
con
data <- dbGetQuery(con,
"SELECT *
FROM raw_data")
data
data_cleaned <- data %>%
as_tibble()
data_cleaned
data_cleaned %>%
filter(variable_id==2)
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(tstamp,value))+
geom_line()+
geom_point()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_hist()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram()+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(col="lightblue")+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue")+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="black")+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)))+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)),size=20)+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)),size=10)+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)),size=2)+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)),size=1)+
scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)),size=1)+
#scale_x_log10()+
theme_light()
data_cleaned %>%
filter(variable_id==2) %>%
ggplot(aes(value))+
geom_histogram(fill="lightblue",col="black")+
geom_vline(aes(xintercept=mean(value)),size=0.5)+
scale_x_log10()+
theme_light()
